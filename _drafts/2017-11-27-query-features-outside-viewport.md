THe goal of my original post about client-side web mapping(link) for large datasets was to create an inexpensive, robust county-wide parcel viewer web map. The base functionality would include the ability both identify and search the parcel data. In the first iteration, I utilized Leaflet as the web mapping API, and [geojson-vt] to cut the loaded GeoJSON into vector-tiles on-the-fly. The map was performant, but the drawback of course is that the client has to load a very large file into the browser, and then cut that file into tiles. This method works well for small datasets, but breaksdown when the size and complexity of the data exceeds the capacity of the network connection or the device capabilities. For example, the load time for a county parcel web map on mobile might exceed 30 seconds. To get around this dilema, one option is to create the vector tiles first, then serve out either static pbf or mvt files, spin up an [mbtiles server]() or even just host the data on Mapbox. These tiles can then be viewed with virtually any web mapping library.

Creating the vector tiles first mitigates the large file size issue, since only the data within the viewport is loaded into the browser. It is important to properly structure the vector tiles such that the there are no very large individuals tiles. This should be verified by inpsecting the network resources utilized by the web app. However, since only the data within the current viewport is available to the client, the data outside the viewport is unknown to the client and therefore not searchable, which is one of the two key components needed for this application. So how do we go about searching for data that exists outside the viewport, especially if we are unwilling to host a dedicated server-side geocode instance for our data?

A wide variety of JavaScript plugins exist for searching JSON dat in the browser. This dataset should still fall within an acceptable file size for mobile applications, but in this case the application is targeted at one county, and we only need to search a few fields. Additionally, our parcel data is already in JSON format, so minimizing this dataset to only those fields we need to search should solve our viewport dilema, at least the search part.



If you are loading tiles into the map via a vector tileserver, the client does not have access to json file. So to search features outside of the viewport I am simply creating a trim down json that contains features I wish to the properties I which to search and in usually latitude and longitude. There are a variety of search plugins to use in the web browser since I am familiar with I am using the jekyll Jekyll simple search login. this plugin the advantage of a template for returned results so we have achieved undo to create the trimmed the process very slightly depending on weather the browser or utilizing a vector tiles storing the data on mapbox essentially we are using the function in JavaScript on the features object of the go Json file returning only those properties that we wish to search pgo Json file does not already have a latitude longitude field or fields. Center turf Js how to calculate the centroid of the feature will utilize this point it is also essential be filled in the Jew Json file which is something that can be created in the browser if you're loading the entire file or making sure that your vector tiles contain this unique ID. this ID will be used features zoom to the latitude longitude we created previously. All of these previous steps all of these steps are fairly straightforward. the difficult problem it's hard to know when the gL map has all the tiles loaded and rendered in order to query or filter features to gain access pretties and the future geometry so that we can show a highlighted feature on the map. so let's assume that you are queering a feature that is not in the current viewport you might use the map. Fly to function to fly to that latitude longitude we created previously on-the-fly end event you could Dan query the features what if the future is is inside the current report well then you can use an if statement fly start event fire query the feature however so how do we get over this hurdle. there are a couple ways that we can achieve its desired result the first is setting up a set interval function source data loading event then checking to see if this event is fired on a certain interval event is determined to no longer is determined to no longer be emitting this event. So this is one way way is to Simply query the features check if there are any features returned time out function to clear the features second third fourth or 5th time us too then once you what's the amount of times where the the amount of time has has expired that you wish to check for feet check for you can create an alert to the user saying no features were found in this way we do not have to rely on flystart fly and Source data loading etc ideally there would be a map. All tiles are rendered event. Of course there are the edge cases where you search for a feature you click on the search result if license location and then the user the animation however your settimeout is still running so therefore we have to clear the query function anytime that we need to add that into the which is fired on the result and also be sure to stop listening for clear the time out when the map is clicked so that we are not events were listening for a necessary Matt this is all separate from on a feature in the map and attempting to query the result that way that instance tiles and data is already loaded and rendered on the map call other post if there are questions or comments happy mapping!
